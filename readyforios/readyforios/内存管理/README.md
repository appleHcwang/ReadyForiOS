

#1 规则
内存管理
1.在iOS中，使用 “引用计数” 来管理OC对象的内存
新创建的OC对象，引用计数是1；
调用retain会让OC对象的引用计数+1，调用release会让OC对象的引用计数-1
当引用计数减为0，OC对象就会销毁，释放占用的内存空间
当调用 alloc、new、copy、mutableCopy 方法返回了一个对象,
，在不需要这个对象时，要调用release或者aoturelease释放

#2 引用计数怎么存储
- 可以直接存储在isa指针中
- 如果不够存储的话，会存储在SideTable结构体的refcnts散列表中

struct SideTable {
    spinlock_t stock;
    RefcountMap refcnts; // 存放着对象引用计数的散列表
    weak_table_t weak_table;
}

#3 ARC具体为引用计数做了哪些工作？
 - 编译阶段自动添加代码

   ARC是LLVM编译器和Runtime系统相互协作的一个结果
- 编译器帮我们实现内存管理相关的代码
- Runtime在程序运行过程中处理弱引用

#4 weak指针实现原理，SideTable的结构是什么样？
1、常用知识点：
- 所引用对象的计数器不会+1，并在引用对象被释放的时候自动被设置为nil
- 通常用于解决循环引用问题

2、weak指针实现原理
- Runtime维护了一个weak表，用于存储指向某个对象的所有weak指针。
- weak表其实就是一个哈希表，key：对象的内存地址；value：指向该对象的所有弱引用的指针
- 当对象销毁的时候，通过对象的地址值，取出对象的弱引用表，将表里面的弱引用清除

3、为什么弱引用不会导致循环引用？
- 没有增加引用计数   

4、SideTable的结构是什么样的?
 struct SideTable {
   // 保证原子操作的自旋锁
    spinlock_t slock;
    // 引用计数的 hash 表
    RefcountMap refcnts;
    // weak 引用全局 hash 表
    weak_table_t weak_table;
}

#5. 自动释放池相关

#6. 内存五大区域
  内存主要分为 栈区 堆区 全局区  常量区 代码区
  
 ## 栈区 定义
  栈是系统数据结构，其对应的进程或者线程是唯一的
  栈是向低地址扩展的数据结构
  栈是一块连续的内存区域，遵循先进后出（FILO）原则
  栈的地址空间在iOS中是以0X7开头
  栈区一般在运行时分配
##存储
栈区是由编译器自动分配并释放的，主要用来存储
局部变量
函数的参数，例如函数的隐藏参数（id self，SEL _cmd）
##优缺点
优点：因为栈是由编译器自动分配并释放的，不会产生内存碎片，所以快速高效
缺点：栈的内存大小有限制，数据不灵活
iOS主线程栈大小是1MB
其他线程是512KB
MAC只有8M

## 堆区
定义
堆是向高地址扩展的数据结构
堆是不连续的内存区域，类似于链表结构（便于增删，不便于查询），遵循先进先出（FIFO）原则
堆的地址空间在iOS中是以0x6开头，其空间的分配总是动态的
堆区的分配一般是在运行时分配

存储
堆区是由程序员动态分配和释放的，如果程序员不释放，程序结束后，可能由操作系统回收，主要用于存放
OC中使用alloc或者 使用new开辟空间创建对象
C语言中使用malloc、calloc、realloc分配的空间，需要free释放

优缺点
优点：灵活方便，数据适应面广泛
缺点：需手动管理，速度慢、容易产生内存碎片
当需要访问堆中内存时，一般需要先通过对象读取到栈区的指针地址，然后通过指针地址访问堆区


##全局区（静态区，即.bss & .data）
全局区是编译时分配的内存空间，在iOS中一般以0x1开头，在程序运行过程中，此内存中的数据一直存在，程序结束后由系统释放，主要存放
未初始化的全局变量和静态变量，即BSS区（.bss）
已初始化的全局变量和静态变量，即数据区（.data）
其中，全局变量是指变量值可以在运行时被动态修改，而静态变量是static修饰的变量，包含静态局部变量和静态全局变量


##常量区（即.rodata）
常量区是编译时分配的内存空间，在程序结束后由系统释放，主要存放

已经使用了的，且没有指向的字符串常量

字符串常量因为可能在程序中被多次使用，所以`在程序运行之前就会提前分配内存

##代码区（即.text）
代码区是编译时分配主要用于存放程序运行时的代码,代码会被编译成二进制存进内存的










# 这是一级标题
## 这是二级标题
### 这是三级标题
#### 这是四级标题
##### 这是五级标题
###### 这是六级标题


**这是加粗的文字**
*这是倾斜的文字*
***这是斜体加粗的文字***
~~这是加删除线的文字~~

>这是引用的内容
>>这是引用的内容
>>>>>>>>>>这是引用的内容


超链接
[简书](http://jianshu.com)
[百度](http://baidu.com)
